<!doctype html><html lang=zh-cn>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Photo by theraygunon Freeimages.com 前因 这里的内网穿透是指能够在家庭网络环境之外接入家庭局域网，能够正常访问 NAS、Homelab 等。
此前已经使用 Wireguard 组建虚拟网的方式实现了上面需求，wg 安装在 Homelab 机器上，但最近想用 PVE 重装下 Homelab ，为了避免在此期间影响接入，准备将穿透服务迁移到群晖 NAS 上。 但并没有官方构建的群晖 Wireguard Package，使用第三方的构建没有安全感，所以准备换用其他方案实现，之前方案中也用到了 gost 来提供云端的 SS 代理，发现其 v3 版本中提供了很多转发特性，所以准备用它来实现。
Gost 的优点：
 纯命令行方案，可以不使用配置文件。 使用 go 开发，单个二进制文件，方便部署。  安装 前往 GitHub 下载对应架构的二进制包，也可自行构建。
https://github.com/go-gost/gost/releases
使用 云主机 云主机需要有公网 IP ，方便移动设备接入。
gost -L &amp;quot;relay+ssh://:56786?bind=true&amp;amp;nodelay=true&amp;amp;authorizedKeys=$HOME/.ssh/authorized_keys&amp;quot; 上面命令会使用 relay + ssh 协议监听本地 56786 端口，授权密钥使用当前用户的 ~/.ssh/authorized_keys 文件。
其中 bind=true 允许请求方指定绑定的端口，nodelay=true 降低延迟。
家庭 NAS NAS 在家庭内网，建议使用 docker 运行下面命令，更容易部署，减少依赖。"><title>使用 Gost 实现内网穿透</title>
<link rel=canonical href=https://zhw.in/post/intranet-penetration-using-gost/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="使用 Gost 实现内网穿透">
<meta property="og:description" content="Photo by theraygunon Freeimages.com 前因 这里的内网穿透是指能够在家庭网络环境之外接入家庭局域网，能够正常访问 NAS、Homelab 等。
此前已经使用 Wireguard 组建虚拟网的方式实现了上面需求，wg 安装在 Homelab 机器上，但最近想用 PVE 重装下 Homelab ，为了避免在此期间影响接入，准备将穿透服务迁移到群晖 NAS 上。 但并没有官方构建的群晖 Wireguard Package，使用第三方的构建没有安全感，所以准备换用其他方案实现，之前方案中也用到了 gost 来提供云端的 SS 代理，发现其 v3 版本中提供了很多转发特性，所以准备用它来实现。
Gost 的优点：
 纯命令行方案，可以不使用配置文件。 使用 go 开发，单个二进制文件，方便部署。  安装 前往 GitHub 下载对应架构的二进制包，也可自行构建。
https://github.com/go-gost/gost/releases
使用 云主机 云主机需要有公网 IP ，方便移动设备接入。
gost -L &amp;quot;relay+ssh://:56786?bind=true&amp;amp;nodelay=true&amp;amp;authorizedKeys=$HOME/.ssh/authorized_keys&amp;quot; 上面命令会使用 relay + ssh 协议监听本地 56786 端口，授权密钥使用当前用户的 ~/.ssh/authorized_keys 文件。
其中 bind=true 允许请求方指定绑定的端口，nodelay=true 降低延迟。
家庭 NAS NAS 在家庭内网，建议使用 docker 运行下面命令，更容易部署，减少依赖。">
<meta property="og:url" content="https://zhw.in/post/intranet-penetration-using-gost/">
<meta property="og:site_name" content="zhwei's Blog">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Tools"><meta property="article:published_time" content="2024-05-25T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-25T00:00:00+00:00"><meta property="og:image" content="https://zhw.in/post/intranet-penetration-using-gost/media/the-tunnel-1446786.jpg">
<meta name=twitter:site content="@zhwei_">
<meta name=twitter:creator content="@zhwei_"><meta name=twitter:title content="使用 Gost 实现内网穿透">
<meta name=twitter:description content="Photo by theraygunon Freeimages.com 前因 这里的内网穿透是指能够在家庭网络环境之外接入家庭局域网，能够正常访问 NAS、Homelab 等。
此前已经使用 Wireguard 组建虚拟网的方式实现了上面需求，wg 安装在 Homelab 机器上，但最近想用 PVE 重装下 Homelab ，为了避免在此期间影响接入，准备将穿透服务迁移到群晖 NAS 上。 但并没有官方构建的群晖 Wireguard Package，使用第三方的构建没有安全感，所以准备换用其他方案实现，之前方案中也用到了 gost 来提供云端的 SS 代理，发现其 v3 版本中提供了很多转发特性，所以准备用它来实现。
Gost 的优点：
 纯命令行方案，可以不使用配置文件。 使用 go 开发，单个二进制文件，方便部署。  安装 前往 GitHub 下载对应架构的二进制包，也可自行构建。
https://github.com/go-gost/gost/releases
使用 云主机 云主机需要有公网 IP ，方便移动设备接入。
gost -L &amp;quot;relay+ssh://:56786?bind=true&amp;amp;nodelay=true&amp;amp;authorizedKeys=$HOME/.ssh/authorized_keys&amp;quot; 上面命令会使用 relay + ssh 协议监听本地 56786 端口，授权密钥使用当前用户的 ~/.ssh/authorized_keys 文件。
其中 bind=true 允许请求方指定绑定的端口，nodelay=true 降低延迟。
家庭 NAS NAS 在家庭内网，建议使用 docker 运行下面命令，更容易部署，减少依赖。"><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://zhw.in/post/intranet-penetration-using-gost/media/the-tunnel-1446786.jpg">
<link rel="shortcut icon" href=/images/favicon.ico>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-189071452-1','auto'),ga('send','pageview'))</script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/post/intranet-penetration-using-gost/>
<img src=/post/intranet-penetration-using-gost/media/the-tunnel-1446786_huc5762784d0864bfadb28c435bd8571f5_754041_800x0_resize_q100_box.jpg srcset="/post/intranet-penetration-using-gost/media/the-tunnel-1446786_huc5762784d0864bfadb28c435bd8571f5_754041_800x0_resize_q100_box.jpg 800w, /post/intranet-penetration-using-gost/media/the-tunnel-1446786_huc5762784d0864bfadb28c435bd8571f5_754041_1600x0_resize_q100_box.jpg 1600w" width=800 height=600 loading=lazy alt="Featured image of post 使用 Gost 实现内网穿透">
</a>
</div>
<div class=article-details>
<h2 class=article-title>
<a href=/post/intranet-penetration-using-gost/>使用 Gost 实现内网穿透</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024-05-25</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
1 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<blockquote>
<p>Photo by theraygun on Freeimages.com</p>
</blockquote>
<h2 id=前因>前因</h2>
<p>这里的内网穿透是指能够在家庭网络环境之外接入家庭局域网，能够正常访问 NAS、Homelab 等。</p>
<p>此前已经使用 Wireguard 组建虚拟网的方式实现了上面需求，wg 安装在 Homelab 机器上，但最近想用 PVE 重装下 Homelab ，为了避免在此期间影响接入，准备将穿透服务迁移到群晖 NAS 上。
但并没有官方构建的群晖 Wireguard Package，使用第三方的构建没有安全感，所以准备换用其他方案实现，之前方案中也用到了 gost 来提供云端的 SS 代理，发现其 v3 版本中提供了很多转发特性，所以准备用它来实现。</p>
<p>Gost 的优点：</p>
<ol>
<li>纯命令行方案，可以不使用配置文件。</li>
<li>使用 go 开发，单个二进制文件，方便部署。</li>
</ol>
<h2 id=安装>安装</h2>
<p>前往 GitHub 下载对应架构的二进制包，也可自行构建。</p>
<p><a class=link href=https://github.com/go-gost/gost/releases target=_blank rel=noopener>https://github.com/go-gost/gost/releases</a></p>
<h2 id=使用>使用</h2>
<h3 id=云主机>云主机</h3>
<p>云主机需要有公网 IP ，方便移动设备接入。</p>
<pre><code>gost -L &quot;relay+ssh://:56786?bind=true&amp;nodelay=true&amp;authorizedKeys=$HOME/.ssh/authorized_keys&quot;
</code></pre><p>上面命令会使用 <a class=link href=https://gost.run/tutorials/protocols/relay/ target=_blank rel=noopener>relay</a> + <a class=link href=https://gost.run/tutorials/protocols/ssh/ target=_blank rel=noopener>ssh</a> 协议监听本地 56786 端口，授权密钥使用当前用户的 <code>~/.ssh/authorized_keys</code> 文件。</p>
<p>其中 bind=true 允许请求方指定绑定的端口，nodelay=true 降低延迟。</p>
<h3 id=家庭-nas>家庭 NAS</h3>
<p>NAS 在家庭内网，建议使用 docker 运行下面命令，更容易部署，减少依赖。</p>
<pre><code>gost \
    -L rtcp://:56787/:8848 \
    -F &quot;relay+ssh://root@CLOUD_SERVER_HOST:56786?privateKeyFile=/path/to/ssh_private_key&amp;nodelay=true&quot; \
    -L ss://AEAD_CHACHA20_POLY1305:xxx@:8848
</code></pre><p>上面命令中：
<code>-L rtcp://:56787/:8848</code> 会将本地的 8848 端口转发到远程的 56787 端口，-F 选项指定了转发协议和链接信息。</p>
<p>第二个 -L 在 8848 端口启动一个 ss 代理。</p>
<p>上面达成的效果是：当移动设备使用 ss 协议连接到云主机的 56787 端口时，会通过 ssh 代理转发到家庭 NAS 的 8848 端口，实现内网穿透，访问家庭网络内的服务。</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/tools/>Tools</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
</aside>
<script src=https://utteranc.es/client.js repo=zhwei/zhwei.github.com issue-term=title label=Comment crossorigin=anonymous async></script>
<style>.utterances{max-width:unset}</style>
<script>function setUtterancesTheme(b){let a=document.querySelector('.utterances iframe');a&&a.contentWindow.postMessage({type:'set-theme',theme:`github-${b}`},'https://utteranc.es')}addEventListener('message',a=>{if(a.origin!=='https://utteranc.es')return;setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener('onColorSchemeChange',a=>{setUtterancesTheme(a.detail)})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2012 -
2024 zhwei's Blog
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.4.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#前因>前因</a></li>
<li><a href=#安装>安装</a></li>
<li><a href=#使用>使用</a>
<ol>
<li><a href=#云主机>云主机</a></li>
<li><a href=#家庭-nas>家庭 NAS</a></li>
</ol>
</li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>